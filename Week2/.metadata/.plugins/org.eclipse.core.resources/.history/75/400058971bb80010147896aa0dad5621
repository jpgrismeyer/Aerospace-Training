#include "hts221.h"

/* helpers */
static HAL_StatusTypeDef _rd(HTS221_t *d, uint8_t reg, uint8_t *buf, uint16_t n){
  return HAL_I2C_Mem_Read(d->hi2c, (d->addr7b<<1), reg, I2C_MEMADD_SIZE_8BIT, buf, n, 100);
}
static HAL_StatusTypeDef _wr_u8(HTS221_t *d, uint8_t reg, uint8_t val){
  return HAL_I2C_Mem_Write(d->hi2c, (d->addr7b<<1), reg, I2C_MEMADD_SIZE_8BIT, &val, 1, 100);
}
static int16_t s16(uint8_t lo, uint8_t hi){ return (int16_t)((hi<<8) | lo); }

HAL_StatusTypeDef HTS221_ReadWhoAmI(HTS221_t *d, uint8_t *who){
  return _rd(d, HTS221_REG_WHO_AM_I, who, 1);
}

HAL_StatusTypeDef HTS221_InitPowerOn(HTS221_t *d){
  uint8_t who=0;
  if (HTS221_ReadWhoAmI(d, &who)!=HAL_OK || who!=HTS221_WHO_AM_I_VAL) return HAL_ERROR;
  uint8_t ctrl1 = (1u<<7) | (1u<<2) | (1u<<0);   // PD=1, BDU=1, ODR=1Hz
  HAL_StatusTypeDef st = _wr_u8(d, HTS221_REG_CTRL1, ctrl1);
  if (st != HAL_OK) return st;
  HAL_Delay(5);
  return HAL_OK;
}

/* ... y las funciones de temperatura/humedad que te pasÃ©, sin cambiar la firma ... */
