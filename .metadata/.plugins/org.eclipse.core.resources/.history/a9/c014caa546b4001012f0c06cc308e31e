/*
 * i2c_scanner.c
 *
 *  Created on: May 25, 2025
 *      Author: admin
 */


#include "stm32l47xx.h"
#include "stm32l47xx_i2c_driver.h"
#include "stm32l475xx_gpio_driver.h"
#include "stm32l475xx_systick.h"

// --- setup mínimo (ejemplo) ---
static I2C_Handle_t I2C1Handle;

void I2C1_GPIOInits(void) {
    GPIOB_PCLK_EN();
    // PB6/PB7 AF4, OD, PU, high speed...
    // (Usa tu GPIO_Init con AF4, OD, PU como ya tenías)
}

void I2C1_Inits(void) {
    I2C1_PCLK_EN()
    // (opcional) reset corto
    RCC->APB1RSTR1 |= I2C1;
  //  RCC->APB1RSTR1 &= ~RCC_APB1RSTR1_I2C1RST;

    I2C1Handle.pI2Cx = I2C1;
    I2C_Init(&I2C1Handle); // tu función con TIMINGR=0x00303D5B
}

int main(void)
{
    SystemClock_Config();  // si la tenés
    I2C1_GPIOInits();
    I2C1_Inits();

    uint8_t who = 0;
    uint8_t addr = 0x5F;     // HTS221 típico
    uint8_t reg  = 0x0F;     // WHO_AM_I

    I2C_MemRead(I2C1, addr, reg, &who, 1);

    // Aquí podés hacer un breakpoint o enviar por UART
    // Valor esperado para HTS221: 0xBC

    while (1) { }
}
